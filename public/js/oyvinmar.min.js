$(function(){function a(){var e,t=n.scrollTop();t>=i&&!o?(o=1,r.addClass("subnav-fixed")):t>=i-s&&!u?($("#topnav").hide(),$("#links").fadeIn(700),u=1):t<=i&&o?(o=0,r.removeClass("subnav-fixed")):t<=i-s&&u&&($("#topnav").show(),$("#links").hide(),u=0)}function f(e,t){var n=e+"@"+t;$("#email").append(' <a href="mailto:'+n+'">'+n+"</a>")}var e=new AppController;window.app=e;var t=$("body");t.scrollspy(t.data()),f("oyvinmar","gmail.com"),$(".nav a").click(function(e){e.preventDefault();var t=$(this).attr("href");$("html,body").animate({scrollTop:$(t).offset().top},500)}),$(".brand").click(function(e){e.preventDefault(),$("html,body").animate({scrollTop:0},500)});var n=$(window),r=$(".subnav"),i=$(".subnav").length&&$(".subnav").offset().top,s=$("#topnav").length&&document.getElementById("topnav").offsetTop,o=0,u=0;n.on("load",function(){window.setTimeout(a,10)}),n.on("scroll",a)});var Entry=Backbone.Model.extend({initialize:function(e){if(!e.timestamp instanceof Date)throw"Timestamp has to be an date object"}}),EntryCollection=Backbone.Collection.extend({model:Entry,comparator:function(e){return-e.get("timestamp").getTime()}}),EntryView=Backbone.View.extend({tagName:"article",className:"entry row-fluid",initialize:function(e){this.el.id=this.model.get("timestamp").getTime()},template:Handlebars.compile('<div class="span1"><img src="/{{ service_name }}64.png" alt="{{ service_name }} logo"/></div><div class="span11"><header><a href="{{{ service_url }}}">{{{ service_name }}}</a></header><p>{{{ content }}}</p><a href="{{{ url }}}"><time title class="published">{{{ timestamp }}}</time></a></div><footer></footer><br/>'),render:function(){var e=_.extend(this.model.toJSON());return $(this.el).html(this.template(e)),this},changeContent:function(){}}),AppModel=Backbone.Model.extend({initialize:function(){this.entries=new EntryCollection}}),AppView=Backbone.View.extend({el:$("#stream"),initialize:function(){this.number_of_entries=5},template:Handlebars.compile('<button class="btn btn-primary show-more" href="#"><i class="icon-plus"></i> Show more</button>'),events:{"click .show-more":"showMore"},render:function(){$("#stream").html("");var e=0,t=this;return this.model.entries.each(function(n){if(e<t.number_of_entries){var r=new EntryView({model:n});$("#stream").append(r.render().el)}e++}),this.model.entries.length>this.number_of_entries&&$("#stream").append(this.template),this},showMore:function(){this.number_of_entries+=10,this.render(),$("body").scrollspy("refresh")}}),AppController=Backbone.Router.extend({initialize:function(e){this.model=new AppModel,this.view=new AppView({model:this.model}),RemoteCallApi.getInstance().fetch_twitter_timeline(),RemoteCallApi.getInstance().fetch_pinboard_feed(),RemoteCallApi.getInstance().fetch_foursquare_timeline()},add:function(e,t,n,r,i){this.model.entries.add(new Entry({content:e,url:t,service_name:n,service_url:r,hidden:!1,timestamp:i}))}}),RemoteCallApi=function(){function t(){var e=function(e){},t=function(e){var t=e.length,n=0;for(n=0;n<t;n++){var r=new Date(e[n].created_at),i=e[n].text;_.each(e[n].entities.urls,function(e){i=i.replace(e.url,'<a href="'+e.url+'">'+e.url+"</a>")}),window.app.add(i,"https://twitter.com/#!/oyvinmar/status/"+e[n].id,"Twitter","http://twitter.com",r)}window.app.view.render()},n=function(e){_.each(e,function(e){window.app.add(e.d,e.u,"Pinboard.in","http://pinboard.in/",new Date(e.dt))}),window.app.view.render()},r=function(e){_.each(e.response.checkins.items,function(e){var t="Checked in at "+e.venue.name;e.venue.hereNow&&(t+=" with "+e.venue.hereNow+" others"),t+=".",window.app.add(t,"https://foursquare.com/v/"+e.venue.id,"Foursquare","http://foursquare.com",new Date(e.createdAt*1e3))}),window.app.view.render()};return{fetch_twitter_timeline:function(){jQuery.ajax({url:"/twitter/feed/",dataType:"json",success:t})},fetch_pinboard_feed:function(){jQuery.ajax({url:"/pinboard/feed/",dataType:"json",crossDomain:!0,success:n})},fetch_foursquare_timeline:function(){jQuery.ajax({url:"/foursquare/feed/",dataType:"json",success:r})}}}var e;return{getInstance:function(){return e||(e=t()),e}}}();