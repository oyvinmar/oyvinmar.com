var RemoteCallApi=function(){function e(){var e=function(e){var t=e.length,n=0;for(n=0;t>n;n++){var i=new Date(e[n].created_at),o=e[n].text;_.each(e[n].entities.urls,function(e){o=o.replace(e.url,'<a href="'+e.url+'">'+e.url+"</a>")}),window.app.add(o,"https://twitter.com/#!/oyvinmar/status/"+e[n].id,"Twitter","http://twitter.com",i)}window.app.view.render()},t=function(e){_.each(e,function(e){window.app.add(e.d,e.u,"Pinboard.in","http://pinboard.in/",new Date(e.dt))}),window.app.view.render()},n=function(e){_.each(e.response.checkins.items,function(e){var t="Checked in at "+e.venue.name;e.venue.hereNow&&(t+=" with "+e.venue.hereNow+" others"),t+=".",window.app.add(t,"https://foursquare.com/v/"+e.venue.id,"Foursquare","http://foursquare.com",new Date(1e3*e.createdAt))}),window.app.view.render()},i=function(e){return'<a href="https://github.com/'+e+'">'+e+"</a>"},o=function(e,t){return t>1?e+"s":e},a=function(e){_.each(e,function(e){var t;if("WatchEvent"===e.type)t="Starred "+i(e.repo.name);else if("PushEvent"===e.type){var n=o(" commit",e.payload.distinct_size);t="Pushed "+n+" to "+i(e.repo.name)}else if("PullRequestEvent"===e.type&&"closed"===e.payload.action){var a=e.payload.pull_request;t='Closed pull request <a href="'+a.html_url+'">'+e.repo.name+"#"+a.number+"</a> from "+i(a.user.login)}t&&window.app.add(t,"https://github.com/"+e.repo.name,"Github","https://github.com",new Date(e.created_at))}),window.app.view.render()};return{fetch_twitter_timeline:function(){jQuery.ajax({url:"/twitter/feed/",dataType:"json",success:e})},fetch_pinboard_feed:function(){jQuery.ajax({url:"/pinboard/feed/",dataType:"json",crossDomain:!0,success:t})},fetch_foursquare_timeline:function(){jQuery.ajax({url:"/foursquare/feed/",dataType:"json",success:n})},fetch_github_events:function(){jQuery.ajax({url:"/github/feed/",dataType:"json",success:a})}}}var t;return{getInstance:function(){return t||(t=e()),t}}}(),Entry=Backbone.Model.extend({initialize:function(e){if(!e.timestamp instanceof Date)throw"Timestamp has to be an date object"}}),EntryCollection=Backbone.Collection.extend({model:Entry,comparator:function(e){return-e.get("timestamp").getTime()}}),EntryView=Backbone.View.extend({tagName:"article",className:"entry row-fluid",initialize:function(){this.el.id=this.model.get("timestamp").getTime()},template:Handlebars.compile('<div class="span1"><img src="/img/{{ service_name }}64.png" alt="{{ service_name }} logo"/></div><div class="span11"><header><a href="{{{ service_url }}}">{{{ service_name }}}</a></header><p>{{{ content }}}</p><a href="{{{ url }}}"><time title class="published">{{{ timestamp }}}</time></a></div><footer></footer><br/>'),render:function(){var e=_.extend(this.model.toJSON());return $(this.el).html(this.template(e)),this},changeContent:function(){}}),AppModel=Backbone.Model.extend({initialize:function(){this.entries=new EntryCollection}}),AppView=Backbone.View.extend({el:$("#stream"),initialize:function(){this.number_of_entries=5},template:Handlebars.compile('<button class="btn btn-primary show-more" href="#"><i class="icon-plus"></i> Show more</button>'),events:{"click .show-more":"showMore"},render:function(){$("#stream").html("");var e=0,t=this;return this.model.entries.each(function(n){if(e<t.number_of_entries){var i=new EntryView({model:n});$("#stream").append(i.render().el)}e++}),this.model.entries.length>this.number_of_entries&&$("#stream").append(this.template),this},showMore:function(){this.number_of_entries+=10,this.render(),$("body").scrollspy("refresh")}}),AppController=Backbone.Router.extend({initialize:function(){this.model=new AppModel,this.view=new AppView({model:this.model}),RemoteCallApi.getInstance().fetch_twitter_timeline(),RemoteCallApi.getInstance().fetch_pinboard_feed(),RemoteCallApi.getInstance().fetch_foursquare_timeline(),RemoteCallApi.getInstance().fetch_github_events()},add:function(e,t,n,i,o){this.model.entries.add(new Entry({content:e,url:t,service_name:n,service_url:i,hidden:!1,timestamp:o}))}});$(function(){function e(){$(".nav a").click(function(e){e.preventDefault();var t=$(this).attr("href");$("html,body").animate({scrollTop:$(t).offset().top},500)}),$(".brand").click(function(e){e.preventDefault(),$("html,body").animate({scrollTop:0},500)}),$("#toggle-menu").click(function(){$("#links").toggle()})}function t(){var e=$("body");e.scrollspy(e.data())}function n(){c.width()<976?($(window).off("scroll",o),$("#topnav").hide(),u.removeClass("subnav-fixed")):(i(),o(),c.on("scroll",o))}function i(){d=$(".subnav").length&&$(".subnav").offset().top,p=$("#topnav").length&&document.getElementById("topnav").offsetTop}function o(){var e=c.scrollTop();e>=d&&!r()?u.addClass("subnav-fixed"):e>=d-p&&!a()?($("#topnav").hide(),$("#links").fadeIn(700)):d>=e&&r()?u.removeClass("subnav-fixed"):d-p>=e&&a()&&($("#topnav").show(),$("#links").hide())}function a(){return!$("#topnav").is(":visible")}function r(){return u.hasClass("subnav-fixed")}function s(e,t){var n=e+"@"+t;$("#email").append(' <a href="mailto:'+n+'">'+n+"</a>")}var l=new AppController;window.app=l,t(),s("oyvinmar","gmail.com"),e();var c=$(window),u=$(".subnav"),d=$(".subnav").length&&$(".subnav").offset().top,p=$("#topnav").length&&document.getElementById("topnav").offsetTop;n(),c.on("load",function(){window.setTimeout(o,10)}),c.on("resize",n)});